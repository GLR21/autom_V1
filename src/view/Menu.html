<html lang="pt-BR" style="overflow-y: hidden;">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<link rel="stylesheet" href="../../node_modules/bootstrap-icons/font/bootstrap-icons.css">
		<link rel="stylesheet" href="../../node_modules/intl-tel-input/build/css/intlTelInput.css">
		<link rel="stylesheet" href="../../node_modules/bulma/css/bulma.min.css">
		<link rel="stylesheet" href="../../resources/css/bulma-switch.min_working.css">
		<link rel="stylesheet" href="../../node_modules/@fortawesome/fontawesome-free/css/all.min.css">
		<title>Autom</title>
	</head>
	<body >
		<nav class="navbar has-shadow is-primary" role="navigation" >
			<div class="navbar-brand">
				<a href="" class="navbar-item" style="cursor: none;pointer-events: none;user-select: none;">
					<figure class="is-rounded">
						<img src="../../resources/images/logo.png" alt="">
					</figure>
				</a>
			</div>
			<div class="navbar-menu">
				<div class="navbar-start">
					<div class="navbar-item has-dropdown is-hoverable">
						<div class="navbar-link">
							Menu
						</div>
						<div class="navbar-dropdown">
							<a class="navbar-item" href="PessoaList.html" >
								<i class="fa-solid fa-users"></i>
								<p class="ml-2">
									Pessoas
								</p>
							</a>
							<a class="navbar-item" href="PessoaForm.html"> 
								<i class="fa-solid fa-user" ></i>
								<p class="ml-2" >
									Cadastro de pessoas
								</p>
							</a>
							<a class="navbar-item" href="PecasList.html" >
								<i class="fa-solid fa-gears"></i>
								<p class="ml-2">
									Peças
								</p>
							</a>
							<a class="navbar-item" href="PecasForm.html" >
								<i class="fa-solid fa-gear"></i>
								<p class="ml-2">
									Cadastro de peças
								</p>
							</a>
						</div>
					</div>
				</div>
				<div class="navbar-end">
					<div class="navbar-item is-centered">
						<span style="pointer-events: all ;cursor: pointer;" id="logout" class="icon pr-5" title="Logout">
							<i class="fa-solid fa-power-off is-large"></i>
						</span>
					</div>
				</div>
			</div>
		</nav>
		  <div class="tile is-ancestor has-text-centered">
			<div style="margin-left: 41rem;" class="tile is-4  pt-6" >
				<div class="tile is-vertical box ">
					<div class="tile is-parent">
						<article class="tile is-child">
							<h1 class="title">
								
							</h1>
						</article>
					</div>
					<div class="tile is-parent">
						<article class="tile is-child">
							<button id="relatorio_pecas_btn" class="button is-large is-info is-light" style="width: 12em;">
								<img style="width: 1em;height: 1em;" class="" src="../../resources/images/file-chart-outline.png" alt="">
								<p class="ml-2">
									Relatório de peças
								</p>
							</button>
						</article>
						<article class="tile is-child">
							<button id="relatorio_pedidos_btn" class="button is-large is-info is-light" style="width: 12em;">
								<img style="width: 1em;height: 1em;" class="" src="../../resources/images/file-chart-outline.png" alt="">
								<p class="ml-2">
									Relatório de pedidos
								</p>
							</button>
						</article>
					</div>
					<div class="tile is-parent">
						<article class="tile is-child">
							<a href="" class="button is-large is-info is-light" style="width: 12em;">
								<img style="width: 1em;height: 1em;"  src="../../resources/images/chart-pie.png" alt="" srcset="">
								<p class="ml-2">
									Pedidos por cliente
								</p>
							</a>
						</article>
						<article class="tile is-child">
							<a href="" id="pedido_peca" class="button is-large is-info is-light" style="width: 12em;">
								<img style="width: 1em;height: 1em;"  src="../../resources/images/chart-pie.png" alt="" srcset="">
								<p class="ml-2">
									Pedidos por peça
								</p>
							</a>
						</article>
					</div>
					<div class="tile is-parent">
						<article class="tile is-child">
							<a href="PedidosForm.html" class="button is-large is-success is-light" style="width: 24.5em;">
								<i class="fa-solid fa-basket-shopping"></i>
								<p class="ml-2">
									Pedidos
								</p>
							</a>
						</article>
					</div>
			  </div>
			</div>
		  </div>

		<!--Modals-->
		  <div id="relatorio_pecas_modal"  class="modal">
			  <div class="modal-background"></div>
			  <div class="modal-content has-background-white py-5 px-5">
					<h3 class="title mb-6">Relatório de Peças</h3>
				 	<p class="control has-icons-left">
						<input id="relatorio_pecas_file_name" name="relatorio_pecas_file_name" type="text" class="input is-rounded" placeholder="Nome">
						<span class="icon is-small is-left">
							<i class="fa-solid fa-folder"></i>	
						</span>
					 </p>
					<p class="control has-icons-left">
						
						<input id="relatorio_pecas_path" name="relatorio_pecas_path" type="text" class="input is-rounded" placeholder="Selecione o diretório onde deseja salvar o relatório" readonly>
						<span class="icon is-small is-left">
							<i class="fa-solid fa-folder"></i>	
						</span>
						<button id="relatorio_pecas_modal_gnrt_report" style="width: 100%;" class="button mt-5 is-success  is-expanded">Gerar relatório</button> 
					</p>
			  </div>
		  </div>

		  <div id="relatorio_pedidos_modal"  class="modal">
			<div class="modal-background"></div>
			<div class="modal-content has-background-white py-5 px-5">
				  <h3 class="title mb-6">Relatório de Pedidos</h3>
				   <p class="control has-icons-left">
					  <input id="relatorio_pedidos_file_name" name="relatorio_pedidos_file_name" type="text" class="input is-rounded" placeholder="Nome">
					  <span class="icon is-small is-left">
						  <i class="fa-solid fa-folder"></i>	
					  </span>
				   </p>
				  <p class="control has-icons-left">
					  
					  <input id="relatorio_pedidos_path" name="relatorio_pedidos_path" type="text" class="input is-rounded" placeholder="Selecione o diretório onde deseja salvar o relatório" readonly>
					  <span class="icon is-small is-left">
						  <i class="fa-solid fa-folder"></i>	
					  </span>
					  <button id="relatorio_pedidos_modal_gnrt_report" style="width: 100%;" class="button mt-5 is-success  is-expanded">Gerar relatório</button> 
				  </p>
			</div>
		</div>

		<!--End_Modals-->
		<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
		<script>
			window.jQuery = require("../../node_modules/jquery/dist/jquery.min.js");
			window.$ = window.jQuery;
		</script>
		<script src="../../node_modules/@vizuaalog/bulmajs/dist/alert.js"></script>
		<script>
			const electron = require('electron');
			const { ipcRenderer } = electron;
			const relatorio_pecas_btn = $( '#relatorio_pecas_btn' );
			const relatorio_pedidos_btn = $( '#relatorio_pedidos_btn' );
			var open_dir;			

			$( document ).ready
			(
				()=>
				{
					$( '#relatorio_pecas_btn' ).click
					(
						()=>
						{
							var modal = $( `#`+relatorio_pecas_btn.attr( 'id' ).replace( 'btn', 'modal' ) );
							modal.addClass( 'is-active' );
						}
					);

					$( '#relatorio_pedidos_btn' ).click
					(
						()=>
						{
							var modal = $( `#`+relatorio_pedidos_btn.attr( 'id' ).replace( 'btn', 'modal' ) );
							modal.addClass( 'is-active' );
						}
					)

					$( document ).keydown( ( e )=>
					{
						if( e.key == "Escape" )
						{
							var modals = document.querySelectorAll( '.modal' );

							modals.forEach
							(
								modal=>
								{
									if( $( modal).hasClass( 'is-active' ) )
									{
										$( modal ).removeClass( 'is-active' );
									}
								}
							)
						}
					} );

					$( '#relatorio_pecas_path' ).click
					(
						()=>
						{
							ipcRenderer.send( 'open:dir', { target:'relatorio_pecas_path' } );
						}
					)

					$( '#relatorio_pedidos_path' ).click
					(
						()=>
						{
							ipcRenderer.send( 'open:dir', { target:'relatorio_pedidos_path' } );
						}
					)

					open_dir = ipcRenderer.on( 'open:dir:select', function( err, item )
					{
						if( !item.path.canceled )
						{
							$( `#${item.target}` ).val( item.path.filePaths[0] );
						}
					} );	

					$( '#relatorio_pecas_modal_gnrt_report' ).click
					(
						()=>
						{
							
							if( $('#relatorio_pecas_path').val() != '' && $('#relatorio_pecas_file_name').val() != '' )
							{
								let name = $('#relatorio_pecas_file_name').val();
								name = name.replace( /\s/g ,'_' );								
								let path = $('#relatorio_pecas_path').val() +'/' + ( name.indexOf( '.' ) > 0 ? name.replace( name.substring( name.indexOf( '.' ) ), '' ) : name) + '.pdf';
								ipcRenderer.send( 'gerar:relatorio:pecas', { path:path } );
							}
							else
							{
								Bulma().alert
								( 
									{
										type   : 'danger',
										title  : 'Atenção!',
										body   : 'Deve ser informado o nome do arquivo e o diretório onde deseja salvar.',
										confirm: 'Ok'
									}
								);
							}
						}
					);

					$( '#relatorio_pedidos_modal_gnrt_report' ).click
					(
						()=>
						{
							
							if( $('#relatorio_pedidos_path').val() != '' && $('#relatorio_pedidos_file_name').val() != '' )
							{
								let name = $('#relatorio_pedidos_file_name').val();
								name = name.replace( /\s/g ,'_' );								
								let path = $('#relatorio_pedidos_path').val() +'/' + ( name.indexOf( '.' ) > 0 ? name.replace( name.substring( name.indexOf( '.' ) ), '' ) : name) + '.pdf';
								ipcRenderer.send( 'gerar:relatorio:pedidos', { path:path } );
							}
							else
							{
								Bulma().alert
								( 
									{
										type   : 'danger',
										title  : 'Atenção!',
										body   : 'Deve ser informado o nome do arquivo e o diretório onde deseja salvar.',
										confirm: 'Ok'
									}
								);
							}
						}
					)


					ipcRenderer.on( 'gerar:relatorio:pecas:response', ( err, item )=>
					{
						if( item )
						{
							Bulma().alert
							( 
								{
									type   : 'success',
									title  : 'Relatório gerado com sucesso',
									confirm:
									{
										label: 'Ok',
										onClick: function()
										{
											$( '#relatorio_pecas_modal' ).removeClass( 'is-active' )
										}
									} 
								}
							);
						}
						else
						{
							Bulma().alert
							( 
								{
									type   : 'danger',
									title  : 'Atenção!',
									body   : 'Houve um erro ao gerar o relatório',
									confirm: 'Ok'
								}
							);
						}
					} )

					ipcRenderer.on( 'gerar:relatorio:pedidos:response', ( err, item )=>
					{
						if( item )
						{
							Bulma().alert
							( 
								{
									type   : 'success',
									title  : 'Relatório gerado com sucesso',
									confirm:
									{
										label: 'Ok',
										onClick: function()
										{
											$( '#relatorio_pedidos_modal' ).removeClass( 'is-active' )
										}
									} 
								}
							);
						}
						else
						{
							Bulma().alert
							( 
								{
									type   : 'danger',
									title  : 'Atenção!',
									body   : 'Houve um erro ao gerar o relatório',
									confirm: 'Ok'
								}
							);
						}
					} )

				}
			)
		</script>
		<script src="../../resources/JS/autum.js"></script>
	</body>
</html>